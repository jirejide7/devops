cd ~
sudo su
SONARQUBE=sonarqube-6.4 # the version number will change over time
wget https://binaries.sonarsource.com/Distribution/sonarqube/$SONARQUBE.zip
apt install -y unzip
unzip $SONARQUBE.zip -d /opt
mv /opt/$SONARQUBE /opt/sonarqube -v

nano /opt/sonarqube/conf/sonar.properties
sonar.jdbc.username=sonarqube
sonar.jdbc.password=$SONAR_PASSWORD
sonar.jdbc.url=jdbc:postgresql://localhost/sonarqube
ctrl+x
y

nano /etc/systemd/system/sonar.service
[Unit]
Description=SonarQube service
After=syslog.target network.target

[Service]
Type=forking

ExecStart=/opt/sonarqube/bin/linux-x86-64/sonar.sh start
ExecStop=/opt/sonarqube/bin/linux-x86-64/sonar.sh stop

User=sonarqube
Group=sonarqube
Restart=always

LimitNOFILE=65536
LimitNPROC=4096

[Install]
WantedBy=multi-user.target
ctrl+x
y

nano /etc/sysctl.d/99-sonarqube.conf
vm.max_map_count=262144
fs.file-max=65536
ctrl+x
y
sysctl vm.max_map_count
sysctl -w vm.max_map_count=262144
sysctl fs.file-max
sysctl -w fs.file-max=65536

groupadd sonarqube
useradd -c "Sonar System User" -d /opt/sonarqube -g sonarqube sonarqube
chown -R sonarqube:sonarqube /opt/sonarqube

nano /opt/sonarqube/bin/linux-x86-64/sonar.sh
RUN_AS_USER=sonarqube
ctrl + x
y

#sudo su sonarqube
systemctl status sonar
q
systemctl enable sonar
systemctl status sonar
q
systemctl start sonar
systemctl status sonar
q
cat /opt/sonarqube/logs/sonar.log
cat /opt/sonarqube/logs/es.log

curl localhost:9000ca
