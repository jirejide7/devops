sudo su
apt update
apt install -y postgresql-common default-jdk
sh /usr/share/postgresql-common/pgdg/apt.postgresql.org.sh
Enter
apt update
apt install -y postgresql postgresql-contrib pgadmin4
apt full-upgrade

systemctl status postgresql
passwd postgres
$POSTGRESQL_PASSWORD
$POSTGRESQL_PASSWORD
su - postgres
$POSTGRESQL_PASSWORD
createuser sonarqube
psql
ALTER USER sonarqube WITH ENCRYPTED password '$SONAR_PASSWORD'
CREATE DATABASE sonarqube OWNER sonarqube
\q
exit

cd ~
SONARQUBE=sonarqube-8.1.0.31237 # the version number will change over time
wget https://binaries.sonarsource.com/Distribution/sonarqube/$SONARQUBE.zip
apt install -y unzip
unzip $SONARQUBE.zip -d /opt
mv /opt/$SONARQUBE /opt/sonarqube -v

nano /opt/sonarqube/conf/sonar.properties
sonar.jdbc.username=sonarqube
sonar.jdbc.password=$SONAR_PASSWORD
sonar.jdbc.url=jdbc:postgresql://localhost/sonar?currentSchema=my_schema
#sonar.search.javaOpts=-Xmx512m -Xms512m -XX:+HeapDumpOnOutOfMemoryError
#sonar.web.javaOpts=-Xmx512m -Xms128m -XX:+HeapDumpOnOutOfMemoryError
#sonar.ce.javaOpts=-Xmx256m -Xms128m -XX:+HeapDumpOnOutOfMemoryError
ctrl+x
y
nano /etc/systemd/system/sonar.service
[Unit]
Description=SonarQube service
After=syslog.target network.target

[Service]
Type=forking

ExecStart=/opt/sonarqube/bin/linux-x86-64/sonar.sh start
ExecStop=/opt/sonarqube/bin/linux-x86-64/sonar.sh stop

User=sonar
Group=sonar
Restart=always

[Install]
WantedBy=multi-user.target
ctrl+x
y
groupadd sonar
useradd -c "Sonar System User" -d /opt/sonarqube -g sonar -s /bin/bash sonar
chown -R sonar:sonar /opt/sonarqube
nano /etc/sonarqube/bin/linux-x86-64/sonar.sh
systemctl enable sonar
systemctl status sonar
q
systemctl start sonar
systemctl status sonar
tail -f /opt/sonarqube/logs/sonar.log
ctrl+c
